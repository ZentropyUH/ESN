#!/bin/bash

########## RESOURCES TO USE ##########

#SBATCH --job-name="lorenz"

#SBATCH --ntasks=1
#SBATCH --cpus-per-task=2
#SBATCH --mem-per-cpu=10000M

#SBATCH --time=14-00:00:00
#SBATCH --partition=long

#SBATCH --array=786,816,834,930,978,1038,1680,1691,1696,1700,1707,1711,1712,1714,1721,1722,1725,1727,1737,1745,1756,1765,1772,1776,1783,1784,1789,1795,1799,1806,1813,1872,1886,1910,1911,1913,1914,1916,1917,1918,1919,1921,1922,1923,1925,1926,1927,1931,1937,1938,1943,1945,1946,1949,1953,1955,1957,1958,1963,1965,1969,1972,1973,1977,1980,1984,1985,1989,1991,1994,1995,1997,2003,2005,2011,2012,2014,2016,2019,2021,2022,2024,2025,2026,2029,2033,2038,2039,2040,2043,2046,2048,2049,2053,2057,2058,2061,2065,2067,2068,2069,2070,2071,2073,2077,2078,2080,2083,2084,2085,2098,2100,2103,2106,2119,2122,2147,2156,2274,2276,2277,2278,2279,2280,2283,2287,2288,2289,2291,2292,2293,2299,2300,2301,2302,2303,2304,2305,2313,2316,2317,2319,2320,2372,2373,2376,2377,2380,2382,2385,2386,2388,2389,2391,2392,2393,2394,2395,2396,2398,2399,2402,2403,2404,2405,2407,2410,2411,2413,2414,2416,2417,2419,2422,2425,2427,2428,2431,2437,2439,2440,2442,2443,2444,2445,2447,2449,2450,2451,2454,2456,2459,2460,2463,2464,2466,2467,2470,2471,2472,2473,2475,2476,2483,2484,2489,2490,2492,2494,2495,2496,2497,2498,2499,2503,2504,2505,2507,2510,2512,2513,2514,2515,2518,2519,2520,2521,2522,2523,2525,2526,2527,2528,2529,2530,2531,2534,2535,2540,2541,2543,2544,2545,2547,2549,2550,2552,2553,2554,2557,2559,2560,2561,2562,2567,2569,2602,2609,2613,2620,2632,2644,2654,2663,2665,2666,2669,2670,2671,2672,2675,2676,2677,2678,2679,2680,2681,2683,2686,2687,2688,2689,2692,2693,2694,2695,2696,2699,2701,2704,2705,2707,2708,2709,2711,2712,2714,2719,2720,2723,2724,2726,2727,2728,2729,2732,2733,2734,2735,2736,2738,2740,2744,2745,2746,2748,2749,2751,2753,2755,2756,2757,2758,2759,2760,2762,2763,2765,2766,2768,2771,2773,2774,2775,2778,2781,2782,2783,2789,2792,2794,2796,2798,2799,2800,2801,2803,2804,2805,2808,2809,2814,2818,2819,2821,2825,2826,2827,2828,2831,2834,2835,2836,2837,2840,2842,2843,2844,2845,2847,2851,2854,2855,2858,2859,2861,2868,2872,2875,2876,2878,2879,2880,2884,2885,2887,2888,2889,2892,2893,2895,2903,2905,2906,2908,2910,2915,2918,2920,2921,2922,2924,2926,2927,2928,2931,2934,2944,2946,2953,2956,2960,2965,2971,2978,2990,2991,3001,3003,3004,3009,3013,3016,3017,3018,3019,3025,3028,3031,3034,3035,3036,3037,3038,3041,3042,3043,3045,3052,3053,3054,3057,3060,3062,3064,3066,3068,3070,3072,3074,3076,3078,3088,3090,3091,3094,3102,3103,3104,3107,3108,3109,3114,3116,3118,3119,3120,3126,3128,3130,3137,3138,3139,3141,3143,3144,3146,3147,3148,3153,3155,3156,3159,3160,3161,3164,3167,3169,3177,3178,3179,3180,3182,3184,3185,3187,3189,3190,3191,3193,3197,3198,3199,3201,3208,3209,3211,3214,3216,3220,3221,3223,3224,3225,3227,3229,3230,3232,3242,3250,3251,3256,3257,3258,3259,3260,3261,3262,3264,3266,3269,3270,3272,3273,3274,3275,3277,3278,3280,3281,3282,3283,3284,3285,3286,3287,3288,3290,3292,3294,3295,3297,3302,3304,3305,3307,3308,3309,3310,3311,3312,3313,3316,3317,3320,3321,3323,3324,3325,3327,3331,3338,3339,3340,3342,3343,3345,3349,3350,3351,3352,3353,3354,3355,3356,3357,3361,3363,3364,3365,3366,3367,3368,3369,3370,3371,3372,3373,3374,3375,3376,3377,3378,3379,3382,3384,3385,3386,3387,3388,3389,3390,3392,3393,3395,3397,3399,3400,3401,3404,3405,3406,3407,3410,3412,3413,3414,3415,3416,3417,3418,3419,3420,3421,3423,3425,3427,3428,3432,3434,3436,3437,3438,3439,3440,3441,3442,3444,3445,3446,3447,3448,3450,3451,3452,3453,3454,3457,3458,3459,3460,3461,3462,3463,3465,3466,3469,3471,3472,3473,3475,3476,3478,3480,3481,3482,3484,3485,3486,3487,3489,3490,3491,3494,3499,3500,3501,3502,3506,3508,3517,3518,3520,3522,3523,3524,3525,3528,3533,3535,3536,3537,3538,3543,3544,3547,3549,3550,3552,3556,3557,3561,3562,3569,3573,3574,3575,3576,3577,3578,3581,3583,3586,3588,3589,3592,3593,3594,3595,3596,3597,3602,3613,3619,3960,4074,4392,4398,4566,5196,5496,6360,6714,6816,7161,7245,7246,7254,7350,7620,7961,8454,8490,8610,8700,8724,8742,8970,9252,9534,9564



########## MODULES ##########

set -e
module purge
module load python/3.10.5

export OMP_NUM_THREADS=$SLURM_CPUS_PER_TASK



########## PATHS ##########

# Create your scratch space
scratch="/scratch/$USER/$SLURM_JOB_ID"
mkdir -p $scratch
cd $scratch

# project path
ESN=$scratch/ESN
mkdir -p $ESN

# output path
output="$scratch/output"
mkdir -p $output

# data path
data="$scratch/data"
mkdir -p $data

# save path
save="/data/tsa/destevez/dennis/Lorenz_fixed/"
mkdir -p $save



########## COPY ##########

# Copy project files to scratch
echo "copying project............"
cp -r /data/tsa/destevez/dennis/ESN/* $ESN

echo "copying data............"
cp -r /data/tsa/destevez/data/Lorenz/* $data
echo "end of copy"



########## RUN ##########

cd $ESN
echo "runing............"
srun python3 tmain.py grid -i $SLURM_ARRAY_TASK_ID -d $data  -o $output
echo "end of run"



########## SAVE ##########

echo "saving............"
cp -r $output/* $save
echo "end of save"



########## CLEANUP & EXIT ##########

# Clean up all the shit
rm -rf $scratch

# Exit gracefully
exit 0

########## END ##########
